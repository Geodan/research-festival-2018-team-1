using System;
using System.Text;
using uPLibrary.Networking.M2Mqtt;
using uPLibrary.Networking.M2Mqtt.Messages;

namespace ConsoleApp9
{
    class Program
    {
        static void Main(string[] args)
        {
            var broker = "broker.hivemq.com";
            var port = 1883;
            var topic = "arena/test";
            var message = "berthoho";

            Console.WriteLine("C# MQTT Client");
            var client = new MqttClient(broker);
            client.MqttMsgPublishReceived += client_MqttMsgPublishReceived;
            var clientId = Guid.NewGuid().ToString();
            client.Connect(clientId);
            Console.WriteLine("Listening....");
            client.Subscribe(new[] { topic }, new[] { MqttMsgBase.QOS_LEVEL_EXACTLY_ONCE });
            client.Publish(topic, Encoding.Default.GetBytes(message));
        }

        private static void client_MqttMsgPublishReceived(object sender, MqttMsgPublishEventArgs e)
        {
            var str = Encoding.Default.GetString(e.Message);
            Console.WriteLine("result: " + str);
        }
    }
}

